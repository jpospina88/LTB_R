---
title: "Clean Grades"
author: "Juan Ospina"
date: "1/22/2019"
output: html_document
---

```{r}
source("../R/packages.R")
```

```{r}
ds <- read.xlsx("../../LTB School Data/Grade data for Lifting the Bar (FINAL).xlsx", sheet = 1, detectDates = TRUE, startRow = 1, colNames = TRUE)
```



```{r}
ds1 <- select(ds, -Notes)
```

```{r eval=FALSE, include=FALSE}
ds1 %>% 
  names %>% 
  noquote
```

# College.Prep.or.NonAcademic
```{r}
dsw <- 
  ds1 %>% 
  select(Participant, contains("College.Prep.or.NonAcademic"))

groups <-
  dsw %>% 
  select(-Participant) %>% 
  names %>% 
  noquote()

dsl <-
  dsw %>% 
  gather(key = term, value = college.prep.or.nonacademic, !!!groups)

dsl %<>% 
  mutate(
    term = term %>% 
      str_replace_all(
        c(
          ",.College.Prep.or.NonAcademic" = "",
          "[.]" = " "
        )
      )
  ) %>% 
  separate(col = term, into = c("term", "course"), sep = ",")

dsl %>% 
  count(term)

dsl %>% 
  count(course)

dsl %>% 
  count(college.prep.or.nonacademic)
```

```{r}
dsl %<>% 
  mutate(
    college.prep.or.nonacademic_c =
      ifelse(
        is.na(college.prep.or.nonacademic), "NA", 
        ifelse(
          college.prep.or.nonacademic == ".", NA,
          ifelse(
            college.prep.or.nonacademic == "NA, P", "P, NA",
            college.prep.or.nonacademic
          )
        )
      )
  )

dsl %>% 
  count(college.prep.or.nonacademic, college.prep.or.nonacademic_c)

dsl_all <- dsl
```

# Repeated

```{r}
dsw <- 
  ds1 %>% 
  select(Participant, contains("Repeated"))

groups <-
  dsw %>% 
  select(-Participant) %>% 
  names %>% 
  noquote()

dsl <-
  dsw %>% 
  gather(key = term, value = repeated, !!!groups)

dsl %<>% 
  mutate(
    term = term %>% 
      str_replace_all(
        c(
          ",.Repeated" = "",
          "[.]" = " ",
          "[?]" = ""
        )
      )
  ) %>% 
  separate(col = term, into = c("term", "course"), sep = ",")

dsl %>% 
  count(term)

dsl %>% 
  count(course)

dsl %>% 
  count(repeated)
```

```{r}
dsl %<>% 
  mutate(
    repeated_c =
      ifelse(
        repeated == ".", NA,
        repeated
      )
  )

dsl %>% 
  count(repeated, repeated_c)
```

```{r}
# merge with full dataset
dsl_all %<>% 
  left_join(dsl, by = c("Participant", "term", "course"))
```

# Subject

```{r}
dsw <- 
  ds1 %>% 
  select(Participant, contains("Subject"))

groups <-
  dsw %>% 
  select(-Participant) %>% 
  names %>% 
  noquote()

dsl <-
  dsw %>% 
  gather(key = term, value = subject, !!!groups)

dsl %<>% 
  mutate(
    term = term %>% 
      str_replace_all(
        c(
          ",.Subject" = "",
          "[.]" = " "
        )
      )
  ) %>% 
  separate(col = term, into = c("term", "course"), sep = ",")

dsl %>% 
  count(term)

dsl %>% 
  count(course)

dsl %>% 
  count(subject)
```

```{r}
dsl %<>% 
  mutate(
    subject_c =
      ifelse(
        subject == ".", NA,
        subject
      )
  )

dsl %>% 
  count(subject, subject_c)
```

```{r}
# merge with full dataset
dsl_all %<>% 
  left_join(dsl, by = c("Participant", "term", "course"))
```

# Name

```{r}
# Fall.2013-2014,.Course.1,.Name                          
# Fall.2013-2014,.Course.1,.Code                          
# Fall.2013-2014,.Course.1,.Grade                         
# Fall.2013-2014,.Course.1,.Credits.Attempted             
# Fall.2013-2014,.Course.1,.Credits.Completed   
```

